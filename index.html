<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Distribution Area & Critical Value Calculator</title>

  <style>
    :root{
      --erau-navy:#002855;
      --erau-gold:#F6BE00;

      --bg:#f4f6f9;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:rgba(15,23,42,.12);

      --radius:18px;
      --shadow:0 10px 25px rgba(0,0,0,.08);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg);
      color:var(--text);
    }

    /* ================= HEADER (ANOVA-like) ================= */

    .topbar{
      background:var(--erau-navy);
      color:#fff;
      padding:22px 32px 18px 32px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
    }

    .topbar-left h1{
      margin:0;
      font-size:22px;
      font-weight:800;
      letter-spacing:.2px;
    }

    .topbar-left p{
      margin:6px 0 0;
      font-size:14px;
      opacity:.9;
    }

    .erau-pill{
      background:var(--erau-gold);
      color:var(--erau-navy);
      padding:10px 18px;
      border-radius:999px;
      font-weight:800;
      font-size:14px;
      white-space:nowrap;
      box-shadow:0 10px 24px rgba(0,0,0,.18);
    }

    .gold-divider{
      height:4px;
      background:var(--erau-gold);
    }

    /* ================= LAYOUT ================= */

    .wrapper{
      max-width:1200px;
      margin:26px auto;
      padding:0 20px 28px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1.25fr;
      gap:24px;
      align-items:start;
    }

    @media(max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .topbar{ padding:18px 18px 14px; flex-wrap:wrap; }
      .erau-pill{ width:fit-content; }
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:20px;
    }

    .card h2{
      margin:0 0 14px;
      font-size:16px;
      font-weight:900;
    }

    /* ================= FORM CONTROLS ================= */

    label{
      display:block;
      font-size:12px;
      font-weight:800;
      color:var(--muted);
      margin:12px 0 6px;
    }

    input, select{
      width:100%;
      padding:10px 11px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.18);
      background:#fff;
      font-size:14px;
      outline:none;
    }

    input:focus, select:focus{
      border-color: rgba(0,40,85,.55);
      box-shadow: 0 0 0 4px rgba(0,40,85,.10);
    }

    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }

    .row.two{
      grid-template-columns: 1fr 1fr;
    }

    @media(max-width: 560px){
      .row.two{ grid-template-columns: 1fr; }
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
      background:var(--erau-navy);
      color:#fff;
      box-shadow:0 10px 22px rgba(0,40,85,.18);
      margin-top:14px;
      width: fit-content;
    }

    .btn:active{ transform: translateY(1px); }

    .note{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    /* ================= RESULTS ================= */

    .msg{
      margin: 0 0 12px;
      padding:10px 12px;
      border-radius:12px;
      font-size:12px;
      font-weight:700;
      display:none;
      white-space:pre-wrap;
    }

    .msg.ok{
      display:none;
      color:#0f766e;
      background:rgba(15,118,110,.07);
      border-left:5px solid #0f766e;
    }

    .msg.warn{
      display:none;
      color:#b91c1c;
      background:rgba(185,28,28,.06);
      border-left:5px solid #b91c1c;
    }

    .pill{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px;
      background:#fbfdff;
      margin-top:12px;
    }

    .pill .k{
      font-size:12px;
      font-weight:900;
      color:var(--muted);
      margin-bottom:6px;
    }

    .pill .v{
      font-family:var(--mono);
      font-size:18px;
      font-weight:900;
      letter-spacing:.2px;
    }

    .mono{
      font-family:var(--mono);
      font-size:12px;
      background:rgba(2,6,23,.04);
      border:1px solid rgba(2,6,23,.08);
      padding:10px 10px;
      border-radius:12px;
      white-space:pre-wrap;
      overflow-x:auto;
      line-height:1.35;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <div class="topbar">
    <div class="topbar-left">
      <h1>Distribution Area &amp; Critical Value Calculator</h1>
      <p>Normal • Gamma • Chi-Square • Exponential</p>
    </div>
    <div class="erau-pill">Embry-Riddle Aeronautical University</div>
  </div>
  <div class="gold-divider"></div>

  <!-- CONTENT -->
  <div class="wrapper">
    <div class="grid">

      <!-- INPUT -->
      <div class="card">
        <h2>Input</h2>

        <label for="dist">Distribution</label>
        <select id="dist">
          <option value="normal">Normal (μ, σ)</option>
          <option value="gamma">Gamma (shape α, scale θ)</option>
          <option value="chisq">Chi-square (df ν)</option>
          <option value="exp">Exponential (rate λ)</option>
        </select>

        <label for="modeSelect">Mode</label>
        <select id="modeSelect">
          <option value="area">Area / Probability</option>
          <option value="inv">Inverse / Critical Value</option>
        </select>

        <!-- params -->
        <div id="params_normal">
          <div class="row two">
            <div>
              <label for="mu">Mean μ</label>
              <input id="mu" type="number" step="any" value="0">
            </div>
            <div>
              <label for="sigma">Std Dev σ</label>
              <input id="sigma" type="number" step="any" value="1">
            </div>
          </div>
        </div>

        <div id="params_gamma" style="display:none;">
          <div class="row two">
            <div>
              <label for="alpha">Shape α</label>
              <input id="alpha" type="number" step="any" value="2">
            </div>
            <div>
              <label for="theta">Scale θ</label>
              <input id="theta" type="number" step="any" value="2">
            </div>
          </div>
        </div>

        <div id="params_chisq" style="display:none;">
          <label for="nu">Degrees of Freedom ν</label>
          <input id="nu" type="number" step="any" value="4">
        </div>

        <div id="params_exp" style="display:none;">
          <label for="lambda">Rate λ</label>
          <input id="lambda" type="number" step="any" value="1">
        </div>

        <!-- AREA -->
        <div id="areaInputs">
          <label for="tail_area">Probability Type</label>
          <select id="tail_area">
            <option value="lt">P(X &lt; x)</option>
            <option value="gt">P(X &gt; x)</option>
            <option value="btw">P(a &lt; X &lt; b)</option>
          </select>

          <div id="x_block">
            <label for="x">x</label>
            <input id="x" type="number" step="any" value="1.5">
          </div>

          <div id="ab_block" style="display:none;">
            <div class="row two">
              <div>
                <label for="a">a</label>
                <input id="a" type="number" step="any" value="1">
              </div>
              <div>
                <label for="b">b</label>
                <input id="b" type="number" step="any" value="3">
              </div>
            </div>
          </div>

          <button class="btn" id="calcArea">Compute Probability</button>
          <div class="note">For Gamma/Chi-square/Exponential, values &lt; 0 have CDF = 0.</div>
        </div>

        <!-- INVERSE -->
        <div id="invInputs" style="display:none;">
          <label for="p_in">p (0 to 1)</label>
          <input id="p_in" type="number" step="any" value="0.95">

          <label for="tail_inv">Critical Value Type</label>
          <select id="tail_inv">
            <option value="lt">Find x where P(X &lt; x) = p</option>
            <option value="gt">Find x where P(X &gt; x) = p</option>
            <option value="btw">Find central interval (equal tails)</option>
          </select>

          <button class="btn" id="calcInv">Compute Critical Value</button>
          <div class="note">Inverse uses bisection + automatic bracketing for monotone CDFs.</div>
        </div>
      </div>

      <!-- RESULTS -->
      <div class="card">
        <h2>Results</h2>

        <div id="ok" class="msg ok"></div>
        <div id="warn" class="msg warn"></div>

        <div class="pill">
          <div class="k" id="outLabel">Probability</div>
          <div class="v" id="pout">—</div>
        </div>

        <div class="pill">
          <div class="k">Interpretation</div>
          <div id="interp">Choose a mode and inputs, then compute.</div>
        </div>

        <div class="pill">
          <div class="k">Computation</div>
          <div class="mono" id="eq">—</div>
        </div>
      </div>

    </div>
  </div>

<script>
/* =========================================================
   Working script for the above IDs
========================================================= */

// Error function approximation (Abramowitz-Stegun 7.1.26)
function erf(x){
  const sign = x < 0 ? -1 : 1;
  x = Math.abs(x);
  const a1=0.254829592, a2=-0.284496736, a3=1.421413741, a4=-1.453152027, a5=1.061405429;
  const p=0.3275911;
  const t = 1.0/(1.0 + p*x);
  const y = 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*Math.exp(-x*x);
  return sign*y;
}

function normalCDF(x, mu, sigma){
  const z = (x - mu) / (sigma * Math.SQRT2);
  return 0.5 * (1 + erf(z));
}

// Lanczos approximation for log-gamma
function gammaln(z){
  const p = [
    676.5203681218851,
   -1259.1392167224028,
    771.32342877765313,
   -176.61502916214059,
    12.507343278686905,
   -0.13857109526572012,
    9.9843695780195716e-6,
    1.5056327351493116e-7
  ];
  if (z < 0.5){
    return Math.log(Math.PI) - Math.log(Math.sin(Math.PI*z)) - gammaln(1 - z);
  }
  z -= 1;
  let x = 0.99999999999980993;
  for (let i=0; i<p.length; i++) x += p[i]/(z + i + 1);
  const t = z + p.length - 0.5;
  return 0.5*Math.log(2*Math.PI) + (z + 0.5)*Math.log(t) - t + Math.log(x);
}

// Regularized lower incomplete gamma P(a, x)
function gammaincLowerReg(a, x){
  if (x <= 0) return 0;
  if (a <= 0) return NaN;

  const ITMAX = 250;
  const EPS = 1e-14;
  const FPMIN = 1e-300;

  if (x < a + 1){
    let ap = a;
    let sum = 1/a;
    let del = sum;
    for (let n=1; n<=ITMAX; n++){
      ap += 1;
      del *= x/ap;
      sum += del;
      if (Math.abs(del) < Math.abs(sum)*EPS) break;
    }
    const result = sum * Math.exp(-x + a*Math.log(x) - gammaln(a));
    return Math.min(1, Math.max(0, result));
  } else {
    let b = x + 1 - a;
    let c = 1 / FPMIN;
    let d = 1 / b;
    let h = d;
    for (let i=1; i<=ITMAX; i++){
      const an = -i*(i - a);
      b += 2;
      d = an*d + b;
      if (Math.abs(d) < FPMIN) d = FPMIN;
      c = b + an/c;
      if (Math.abs(c) < FPMIN) c = FPMIN;
      d = 1/d;
      const del = d*c;
      h *= del;
      if (Math.abs(del - 1) < EPS) break;
    }
    const q = Math.exp(-x + a*Math.log(x) - gammaln(a)) * h;
    const p = 1 - q;
    return Math.min(1, Math.max(0, p));
  }
}

function gammaCDF(x, alpha, theta){
  if (x <= 0) return 0;
  if (alpha <= 0 || theta <= 0) return NaN;
  return gammaincLowerReg(alpha, x/theta);
}

function chisqCDF(x, nu){
  if (x <= 0) return 0;
  if (nu <= 0) return NaN;
  return gammaCDF(x, nu/2, 2);
}

function expCDF(x, lambda){
  if (x <= 0) return 0;
  if (lambda <= 0) return NaN;
  return 1 - Math.exp(-lambda*x);
}

function clamp01(p){
  if (!isFinite(p)) return NaN;
  return Math.min(1, Math.max(0, p));
}

function fmt(x){
  if (!isFinite(x)) return "—";
  const s = x.toFixed(10);
  return s.replace(/\.?0+$/, "");
}

// ---------- Inverse solver (bisection with auto-bracket) ----------

function bisectSolve(F, target, lo, hi, tol=1e-10, maxIter=200){
  let flo = F(lo) - target;
  let fhi = F(hi) - target;

  if (!isFinite(flo) || !isFinite(fhi)) return {x: NaN, err:"Non-finite function values in solver interval."};
  if (flo === 0) return {x: lo};
  if (fhi === 0) return {x: hi};
  if (flo*fhi > 0) return {x: NaN, err:"Root is not bracketed."};

  for (let i=0; i<maxIter; i++){
    const mid = 0.5*(lo+hi);
    const fmid = F(mid) - target;
    if (!isFinite(fmid)) return {x: NaN, err:"Non-finite function value during solve."};
    if (Math.abs(fmid) < tol || (hi-lo)/2 < tol) return {x: mid};
    if (flo*fmid <= 0){
      hi = mid; fhi = fmid;
    } else {
      lo = mid; flo = fmid;
    }
  }
  return {x: 0.5*(lo+hi), warn:"Max iterations reached; returning best estimate."};
}

function invertMonotoneCDF(F, target, support){
  if (!(target >= 0 && target <= 1) || !isFinite(target)){
    return {x: NaN, err:"Target probability must be between 0 and 1."};
  }
  if (target === 0) return {x: support.min};
  if (target === 1) return {x: support.max};

  let lo = support.min;
  let hi = Math.max(support.start, lo);

  let fhi = F(hi);
  let step = support.step;

  for (let k=0; k<140 && fhi < target; k++){
    if (hi >= support.max) break;
    hi = Math.min(support.max, hi + step);
    fhi = F(hi);
    step *= support.grow;
  }

  const flo = F(lo);
  if (!(flo <= target && target <= fhi)){
    return {x: NaN, err:`Could not bracket target.\nF(lo)=${flo}, F(hi)=${fhi}`};
  }
  return bisectSolve(F, target, lo, hi);
}

// ---------- DOM helpers ----------

const el = (id) => document.getElementById(id);

function setMsg(id, text){
  const node = el(id);
  node.textContent = text || "";
  node.style.display = text ? "block" : "none";
}

function clearMessages(){
  setMsg("warn", "");
  setMsg("ok", "");
}

// ---------- Distribution CDF + support ----------

function getCDFAndSupport(){
  const d = el("dist").value;

  if (d === "normal"){
    const mu = Number(el("mu").value);
    const sigma = Number(el("sigma").value);
    if (!(sigma > 0)) return {err:"For Normal, σ must be > 0."};
    return {
      F: (x) => normalCDF(x, mu, sigma),
      desc: `Normal(μ=${mu}, σ=${sigma})`,
      support: { min: mu - 12*sigma, start: mu, step: 1*sigma, grow: 1.8, max: mu + 12*sigma }
    };
  }

  if (d === "gamma"){
    const alpha = Number(el("alpha").value);
    const theta = Number(el("theta").value);
    if (!(alpha > 0 && theta > 0)) return {err:"For Gamma, α and θ must be > 0."};
    const mean = alpha*theta;
    const sd = Math.sqrt(alpha)*theta;
    return {
      F: (x) => gammaCDF(x, alpha, theta),
      desc: `Gamma(α=${alpha}, θ=${theta})`,
      support: { min: 0, start: Math.max(0, mean), step: Math.max(1e-6, sd/2), grow: 1.8, max: mean + 60*sd + 10 }
    };
  }

  if (d === "chisq"){
    const nu = Number(el("nu").value);
    if (!(nu > 0)) return {err:"For Chi-square, ν must be > 0."};
    const mean = nu;
    const sd = Math.sqrt(2*nu);
    return {
      F: (x) => chisqCDF(x, nu),
      desc: `Chi-square(ν=${nu})`,
      support: { min: 0, start: Math.max(0, mean), step: Math.max(1e-6, sd/2), grow: 1.8, max: mean + 60*sd + 10 }
    };
  }

  if (d === "exp"){
    const lambda = Number(el("lambda").value);
    if (!(lambda > 0)) return {err:"For Exponential, λ must be > 0."};
    const mean = 1/lambda;
    const sd = 1/lambda;
    return {
      F: (x) => expCDF(x, lambda),
      desc: `Exponential(λ=${lambda})`,
      support: { min: 0, start: mean, step: Math.max(1e-6, sd/2), grow: 1.8, max: mean + 100*sd + 10 }
    };
  }

  return {err:"Unknown distribution selection."};
}

// ---------- UI toggles ----------

function updateParamVisibility(){
  const d = el("dist").value;
  el("params_normal").style.display = (d==="normal") ? "" : "none";
  el("params_gamma").style.display  = (d==="gamma")  ? "" : "none";
  el("params_chisq").style.display  = (d==="chisq")  ? "" : "none";
  el("params_exp").style.display    = (d==="exp")    ? "" : "none";
}

function updateModeVisibility(){
  const mode = el("modeSelect").value;
  el("areaInputs").style.display = (mode === "area") ? "" : "none";
  el("invInputs").style.display  = (mode === "inv")  ? "" : "none";
  el("outLabel").textContent = (mode === "area") ? "Probability" : "Critical value";
}

function updateAreaInputVisibility(){
  const t = el("tail_area").value;
  el("x_block").style.display  = (t === "btw") ? "none" : "";
  el("ab_block").style.display = (t === "btw") ? "" : "none";
}

// ---------- Calculations ----------

function computeArea(){
  clearMessages();
  const pack = getCDFAndSupport();
  if (pack.err){ setMsg("warn", pack.err); return; }

  const F = pack.F;
  const distDesc = pack.desc;
  const t = el("tail_area").value;

  let prob, eq, interp;

  if (t === "lt"){
    const x = Number(el("x").value);
    const Fx = clamp01(F(x));
    prob = Fx;
    interp = `P(X < ${x}) for ${distDesc}`;
    eq = `P(X < x) = F(x)\nF(${x}) = ${prob}`;
  } else if (t === "gt"){
    const x = Number(el("x").value);
    const Fx = clamp01(F(x));
    prob = clamp01(1 - Fx);
    interp = `P(X > ${x}) for ${distDesc}`;
    eq = `P(X > x) = 1 - F(x)\n1 - F(${x}) = ${prob}`;
  } else {
    const a = Number(el("a").value);
    const b = Number(el("b").value);
    const lo = Math.min(a,b);
    const hi = Math.max(a,b);

    const Flo = clamp01(F(lo));
    const Fhi = clamp01(F(hi));

    prob = clamp01(Fhi - Flo);
    interp = `P(${lo} < X < ${hi}) for ${distDesc}`;
    eq = `P(a < X < b) = F(b) - F(a)\nF(${hi}) - F(${lo}) = ${prob}`;
  }

  el("outLabel").textContent = "Probability";
  el("pout").textContent = fmt(prob);
  el("interp").textContent = interp;
  el("eq").textContent = eq;
  setMsg("ok", "Computed successfully.");
}

function computeInverse(){
  clearMessages();
  const pack = getCDFAndSupport();
  if (pack.err){ setMsg("warn", pack.err); return; }

  const F = pack.F;
  const sup = pack.support;
  const distDesc = pack.desc;

  const p = Number(el("p_in").value);
  if (!(p >= 0 && p <= 1) || !isFinite(p)){
    setMsg("warn", "p must be a finite number between 0 and 1.");
    return;
  }

  const t = el("tail_inv").value;

  if (t === "lt"){
    const sol = invertMonotoneCDF(F, p, sup);
    if (sol.err){ setMsg("warn", sol.err); return; }

    el("outLabel").textContent = "Critical value x";
    el("pout").textContent = fmt(sol.x);
    el("interp").textContent = `Find x such that P(X < x) = ${fmt(p)} for ${distDesc}`;
    el("eq").textContent = `Solve F(x)=p\np=${p}\nx=${sol.x}`;
    setMsg("ok", sol.warn ? ("Computed (warning): " + sol.warn) : "Computed successfully.");
  } else if (t === "gt"){
    const target = 1 - p;
    const sol = invertMonotoneCDF(F, target, sup);
    if (sol.err){ setMsg("warn", sol.err); return; }

    el("outLabel").textContent = "Critical value x";
    el("pout").textContent = fmt(sol.x);
    el("interp").textContent = `Find x such that P(X > x) = ${fmt(p)} for ${distDesc}`;
    el("eq").textContent = `Solve 1-F(x)=p  ⇒  F(x)=1-p\n1-p=${target}\nx=${sol.x}`;
    setMsg("ok", sol.warn ? ("Computed (warning): " + sol.warn) : "Computed successfully.");
  } else {
    const tail = (1 - p) / 2;
    const pL = tail;
    const pU = 1 - tail;

    const solL = invertMonotoneCDF(F, pL, sup);
    const solU = invertMonotoneCDF(F, pU, sup);
    if (solL.err){ setMsg("warn", "Lower bound failed:\n" + solL.err); return; }
    if (solU.err){ setMsg("warn", "Upper bound failed:\n" + solU.err); return; }

    el("outLabel").textContent = "Central interval [L, U]";
    el("pout").textContent = `[${fmt(solL.x)}, ${fmt(solU.x)}]`;
    el("interp").textContent = `Find L,U such that P(L < X < U) = ${fmt(p)} (equal tails) for ${distDesc}`;
    el("eq").textContent =
      `L = F^{-1}((1-p)/2), U = F^{-1}(1-(1-p)/2)\n` +
      `(1-p)/2=${tail}\nL=${solL.x}\nU=${solU.x}`;
    setMsg("ok", "Computed successfully.");
  }
}

// ---------- Wire up events ----------

function init(){
  updateParamVisibility();
  updateModeVisibility();
  updateAreaInputVisibility();

  el("dist").addEventListener("change", () => { updateParamVisibility(); clearMessages(); });
  el("modeSelect").addEventListener("change", () => { updateModeVisibility(); clearMessages(); });
  el("tail_area").addEventListener("change", () => { updateAreaInputVisibility(); clearMessages(); });

  el("calcArea").addEventListener("click", computeArea);
  el("calcInv").addEventListener("click", computeInverse);

  el("pout").textContent = "—";
  el("interp").textContent = "Choose a mode and inputs, then compute.";
  el("eq").textContent = "—";
}

init();
</script>

</body>
</html>
